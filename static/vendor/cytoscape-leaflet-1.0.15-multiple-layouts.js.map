{"version":3,"file":"cytoscape-leaflet-1.0.15-multiple-layouts.js","sources":["../node_modules/@babel/runtime/helpers/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/nonIterableRest.js","../node_modules/@babel/runtime/helpers/slicedToArray.js","../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../node_modules/@babel/runtime/helpers/defineProperty.js","../node_modules/memoize-one/dist/memoize-one.esm.js","../src/utils.ts","../src/mapHandler.ts","../src/index.ts"],"sourcesContent":["function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableRest, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithHoles = require(\"./arrayWithHoles.js\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit.js\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\n\nvar nonIterableRest = require(\"./nonIterableRest.js\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var safeIsNaN = Number.isNaN ||\n    function ponyfill(value) {\n        return typeof value === 'number' && value !== value;\n    };\nfunction isEqual(first, second) {\n    if (first === second) {\n        return true;\n    }\n    if (safeIsNaN(first) && safeIsNaN(second)) {\n        return true;\n    }\n    return false;\n}\nfunction areInputsEqual(newInputs, lastInputs) {\n    if (newInputs.length !== lastInputs.length) {\n        return false;\n    }\n    for (var i = 0; i < newInputs.length; i++) {\n        if (!isEqual(newInputs[i], lastInputs[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction memoizeOne(resultFn, isEqual) {\n    if (isEqual === void 0) { isEqual = areInputsEqual; }\n    var cache = null;\n    function memoized() {\n        var newArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            newArgs[_i] = arguments[_i];\n        }\n        if (cache && cache.lastThis === this && isEqual(newArgs, cache.lastArgs)) {\n            return cache.lastResult;\n        }\n        var lastResult = resultFn.apply(this, newArgs);\n        cache = {\n            lastResult: lastResult,\n            lastArgs: newArgs,\n            lastThis: this,\n        };\n        return lastResult;\n    }\n    memoized.clear = function clear() {\n        cache = null;\n    };\n    return memoized;\n}\n\nexport { memoizeOne as default };\n","import memoizeOne from 'memoize-one';\r\n\r\n/**\r\n * @see https://github.com/cytoscape/cytoscape.js/blob/master/src/extensions/renderer/base/load-listeners.js\r\n */\r\nexport function isMultSelKeyDown(event: MouseEvent) {\r\n  return event.shiftKey || event.metaKey || event.ctrlKey; // maybe event.altKey\r\n}\r\n\r\n/**\r\n * @param {cytoscape.Position} position1\r\n * @param {cytoscape.Position} position2\r\n * @return {boolean}\r\n */\r\nfunction arePositionsEqual(\r\n  position1: cytoscape.Position,\r\n  position2: cytoscape.Position\r\n) {\r\n  return position1.x === position2.x && position1.y === position2.y;\r\n}\r\n\r\nexport function getUpdatedPositions(\r\n  currentPositions: cytoscape.NodePositionMap,\r\n  positions: cytoscape.NodePositionMap\r\n): cytoscape.NodePositionMap {\r\n  return Object.fromEntries(\r\n    Object.entries(positions).filter(([id, position]) => {\r\n      const currentPosition = currentPositions[id];\r\n      return !arePositionsEqual(currentPosition, position);\r\n    })\r\n  );\r\n}\r\n\r\nexport const getUpdatedPositionsMemo = memoizeOne(getUpdatedPositions);\r\nexport const assign = Object.assign != null ? Object.assign.bind( Object ) : function( tgt: any, ...srcs: any[] ){\r\n  srcs.forEach( src => {\r\n    Object.keys( src ).forEach( k => tgt[k] = src[k] );\r\n  } );\r\n\r\n  return tgt;\r\n};\r\n","import L, { PointTuple } from 'leaflet';\r\nimport { MapHandlerOptions } from './types';\r\nimport { getUpdatedPositionsMemo, isMultSelKeyDown, assign } from './utils';\r\nimport cytoscape from 'cytoscape';\r\n// import { filter } from 'minimatch';\r\n\r\nconst DEFAULT_FIT_PADDING: PointTuple = [50, 50];\r\nconst DEFAULT_ANIMATION_DURATION = 1;\r\nconst HIDDEN_CLASS = 'cytoscape-map__hidden';\r\n\r\nconst DEFAULT_LAYOUT = {\r\n  name: 'preset',\r\n}\r\n\r\nexport class MapHandler {\r\n  cy: cytoscape.Core | undefined;\r\n  mapOptions: L.MapOptions;\r\n  options: MapHandlerOptions | undefined;\r\n\r\n  mapContainer: HTMLElement | undefined;\r\n  map: L.Map | undefined;\r\n\r\n  originalAutoungrabify: boolean | undefined;\r\n  originalUserZoomingEnabled: boolean | undefined;\r\n  originalUserPanningEnabled: boolean | undefined;\r\n\r\n  originalPositions: cytoscape.NodePositionMap | undefined;\r\n  originalZoom: number | undefined;\r\n  originalPan: cytoscape.Position | undefined;\r\n\r\n  panning: boolean = false;\r\n  layouting: boolean = false;\r\n\r\n  requestAnimationId: number | undefined;\r\n\r\n  onGraphContainerMouseDownBound = this.onGraphContainerMouseDown.bind(this);\r\n  onGraphContainerMouseMoveBound = this.onGraphContainerMouseMove.bind(this);\r\n  onGraphContainerWheelBound = this.onGraphContainerWheel.bind(this);\r\n  onMapMoveBound = this.onMapMove.bind(this);\r\n\r\n  onLayoutStartBound = this.onLayoutStart.bind(this);\r\n  onLayoutStopBound = this.onLayoutStop.bind(this);\r\n\r\n  onGraphAddBound = this.onGraphAdd.bind(this);\r\n  onGraphResizeBound = this.onGraphResize.bind(this);\r\n  onGraphDragFreeBound = this.onGraphDragFree.bind(this);\r\n  onDataChangeBound = this.onDataChange.bind(this);\r\n\r\n  /**\r\n   * @param {cytoscape.Core} cy\r\n   * @param {L.MapOptions} mapOptions\r\n   * @param {MapHandlerOptions} options\r\n   */\r\n  constructor(\r\n    cy: cytoscape.Core,\r\n    mapOptions: L.MapOptions,\r\n    options: MapHandlerOptions\r\n  ) {\r\n    this.cy = cy;\r\n    this.mapOptions = mapOptions;\r\n    this.options = options;\r\n\r\n    if (!(typeof this.options.getPosition === 'function')) {\r\n      throw new Error('getPosition should be a function');\r\n    }\r\n    if (\r\n      this.options.setPosition &&\r\n      !(typeof this.options.setPosition === 'function')\r\n    ) {\r\n      throw new Error('setPosition should be a function');\r\n    }\r\n\r\n    // Cytoscape config\r\n    this.originalAutoungrabify = this.cy.autoungrabify();\r\n    this.originalUserZoomingEnabled = this.cy.userZoomingEnabled();\r\n    this.originalUserPanningEnabled = this.cy.userPanningEnabled();\r\n\r\n    this.cy.userZoomingEnabled(false);\r\n    this.cy.userPanningEnabled(false);\r\n\r\n    // Cytoscape events\r\n    const graphContainer = this.cy.container() as unknown as HTMLElement;\r\n    graphContainer.addEventListener(\r\n      'mousedown',\r\n      this.onGraphContainerMouseDownBound\r\n    );\r\n    graphContainer.addEventListener(\r\n      'mousemove',\r\n      this.onGraphContainerMouseMoveBound\r\n    );\r\n    graphContainer.addEventListener('wheel', this.onGraphContainerWheelBound);\r\n    this.cy.on('add', this.onGraphAddBound);\r\n    this.cy.on('resize', this.onGraphResizeBound);\r\n    this.cy.on('dragfree', this.onGraphDragFreeBound);\r\n    this.cy.on('data', this.onDataChangeBound);\r\n\r\n    this.cy.on(\"layoutstart \", this.onLayoutStartBound);\r\n    this.cy.on(\"layoutstop\", this.onLayoutStopBound);\r\n\r\n    // Map container\r\n    this.mapContainer = document.createElement('div');\r\n    this.mapContainer.style.position = 'absolute';\r\n    this.mapContainer.style.top = '0px';\r\n    this.mapContainer.style.left = '0px';\r\n    this.mapContainer.style.width = '100%';\r\n    this.mapContainer.style.height = '100%';\r\n\r\n    graphContainer?.prepend(this.mapContainer);\r\n\r\n    // Leaflet instance\r\n    this.map = new L.Map(this.mapContainer, this.mapOptions);\r\n    this.fit(undefined, { padding: DEFAULT_FIT_PADDING, animate: false });\r\n\r\n    // Map events\r\n    this.map.on('move', this.onMapMoveBound);\r\n\r\n    // Cytoscape unit viewport\r\n    this.originalZoom = this.cy.zoom();\r\n    this.originalPan = { ...this.cy.pan() };\r\n\r\n    const zoom = 1;\r\n    const pan = { x: 0, y: 0 };\r\n\r\n    if (this.options.animate) {\r\n      this.cy.animate(\r\n        {\r\n          zoom: zoom,\r\n          pan: pan,\r\n        },\r\n        {\r\n          duration:\r\n            this.options.animationDuration ?? DEFAULT_ANIMATION_DURATION,\r\n          easing: 'linear',\r\n        }\r\n      );\r\n    } else {\r\n      this.cy.viewport({ zoom, pan });\r\n    }\r\n\r\n    // Cytoscape positions\r\n    this.enableGeographicPositions();\r\n  }\r\n\r\n  destroy() {\r\n    // Cytoscape events\r\n    const graphContainer = this.cy?.container();\r\n    if (graphContainer) {\r\n      graphContainer.removeEventListener(\r\n        'mousedown',\r\n        this.onGraphContainerMouseDownBound\r\n      );\r\n      graphContainer.removeEventListener(\r\n        'mousemove',\r\n        this.onGraphContainerMouseMoveBound\r\n      );\r\n      graphContainer.removeEventListener(\r\n        'wheel',\r\n        this.onGraphContainerWheelBound\r\n      );\r\n    }\r\n    if (this.cy) {\r\n      this.cy.off('add', this.onGraphAddBound);\r\n      this.cy.off('resize', this.onGraphResizeBound);\r\n      this.cy.off('dragfree', this.onGraphDragFreeBound);\r\n      this.cy.off('data', this.onDataChangeBound);\r\n\r\n      this.cy.off('layoutstart', this.onLayoutStartBound);\r\n      this.cy.off('layoutstop', this.onLayoutStopBound);\r\n\r\n      // Cytoscape config\r\n      this.cy.autoungrabify(this.originalAutoungrabify);\r\n      this.cy.userZoomingEnabled(this.originalUserZoomingEnabled);\r\n      this.cy.userPanningEnabled(this.originalUserPanningEnabled);\r\n    }\r\n    this.originalAutoungrabify = undefined;\r\n    this.originalUserZoomingEnabled = undefined;\r\n    this.originalUserPanningEnabled = undefined;\r\n\r\n    // Map events\r\n    this.map?.off('move', this.onMapMoveBound);\r\n\r\n    // Map instance\r\n    this.map?.remove();\r\n    this.map = undefined;\r\n\r\n    // Map container\r\n    this.mapContainer?.remove();\r\n    this.mapContainer = undefined;\r\n\r\n    // Cytoscape unit viewport\r\n    if (this.options?.animate) {\r\n      this.cy?.animate(\r\n        {\r\n          zoom: this.originalZoom,\r\n          pan: this.originalPan,\r\n        },\r\n        {\r\n          duration:\r\n            this.options.animationDuration ?? DEFAULT_ANIMATION_DURATION,\r\n          easing: 'linear',\r\n        }\r\n      );\r\n    } else {\r\n      this.cy?.viewport({\r\n        zoom: this.originalZoom ?? 5,\r\n        pan:\r\n          this.originalPan ??\r\n          ({\r\n            x: 0,\r\n            y: 0,\r\n          } as cytoscape.Position),\r\n      });\r\n    }\r\n\r\n    this.originalZoom = undefined;\r\n    this.originalPan = undefined;\r\n\r\n    // Cytoscape positions\r\n    this.disableGeographicPositions();\r\n\r\n    this.cy = undefined;\r\n    this.options = undefined;\r\n  }\r\n\r\n  /**\r\n   * @param {cytoscape.NodeCollection} nodes\r\n   * @param {L.FitBoundsOptions} options\r\n   */\r\n  fit(\r\n    nodes: cytoscape.NodeCollection = this.cy?.nodes() ??\r\n    ([] as unknown as cytoscape.NodeCollection),\r\n    options: L.FitBoundsOptions\r\n  ) {\r\n    const bounds = this.getNodeLngLatBounds(nodes);\r\n    if (!bounds.isValid()) {\r\n      return;\r\n    }\r\n\r\n    this.map?.fitBounds(bounds, options);\r\n  }\r\n\r\n  /**\r\n   * @return {cytoscape.LayoutOptions}\r\n   * @param {*} [customOptions]\r\n   */\r\n  private getDefaultLayout(customOptions: any = undefined): cytoscape.LayoutOptions {\r\n    return assign(DEFAULT_LAYOUT, this.options?.layout, customOptions);\r\n  }\r\n\r\n  /**\r\n   * Run layout. By default, all nodes are updated\r\n   * @param nodes run the layout for specific nodes\r\n   * @private\r\n   */\r\n  private runDefaultLayout(\r\n    nodes = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n  ) {\r\n    this.deleteInternalLayoutPosition(nodes);\r\n    nodes.layout(this.getDefaultLayout()).run();\r\n  }\r\n\r\n\r\n  /**\r\n   * Save each node current layout position as the current geographical position.\r\n   * Node's position is saved into its scratch, as <i>leaflet</i> namespace and <i>currentGeoposition<i> LatLng object\r\n   * @param {cytoscape.NodeCollection} nodes\r\n   */\r\n  private saveInternalLayoutPositionAsLatLng(\r\n    nodes: cytoscape.NodeCollection = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n  ) {\r\n    nodes?.forEach((node) => {\r\n        // if (!(node.scratch('leaflet') && node.scratch('leaflet')['currentGeoposition'])) {\r\n        // @ts-ignore\r\n        node.scratch('leaflet', {currentGeoposition: this.map?.containerPointToLatLng(node.position())})\r\n        // }\r\n      }\r\n    );\r\n\r\n  }\r\n\r\n  /**\r\n   * Delete layout geographic position from each node's scratch\r\n   * @param nodes\r\n   */\r\n  private deleteInternalLayoutPosition(\r\n    nodes: cytoscape.NodeCollection = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n  ) {\r\n    nodes?.forEach((node) => {\r\n      if (node.scratch('leaflet') && node.scratch('leaflet').currentGeoposition) {\r\n        delete node.scratch('leaflet').currentGeoposition;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  private enableGeographicPositions() {\r\n    const nodes: cytoscape.NodeCollection =\r\n      this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection);\r\n\r\n    this.originalPositions = Object.fromEntries(\r\n      nodes.map((node) => {\r\n        return [node.id(), { ...node.position() }];\r\n      })\r\n    );\r\n\r\n    const positions: cytoscape.NodePositionMap = Object.fromEntries(\r\n      nodes\r\n        .map((node) => {\r\n          return [node.id(), this.getGeographicPosition(node)];\r\n        })\r\n        .filter(([_id, position]) => {\r\n          return !!position;\r\n        })\r\n    );\r\n\r\n    const nodesWithoutPosition = nodes.filter((node) => !positions[node.id()]);\r\n    const nodesWithPosition = nodes.filter((node) => !!positions[node.id()]);\r\n\r\n    if (this.options?.hideNonPositional) {\r\n      // hide nodes without position\r\n      nodesWithoutPosition.addClass(HIDDEN_CLASS).style('display', 'none');\r\n    }\r\n\r\n    nodesWithPosition\r\n      ?.layout({\r\n        name: 'preset',\r\n        positions: positions,\r\n        fit: false,\r\n        animate: this.options?.animate,\r\n        animationDuration:\r\n          this.options?.animationDuration ?? DEFAULT_ANIMATION_DURATION,\r\n        animationEasing: 'ease-out-cubic',\r\n      })\r\n      .run();\r\n\r\n    nodesWithoutPosition\r\n      ?.layout(this.getDefaultLayout())\r\n      .run();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.NodeCollection | undefined} nodes\r\n   */\r\n  private updateGeographicPositions(\r\n    nodes = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n  ) {\r\n    const updatePositions = (\r\n      nodes = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n    ) => {\r\n      const positions: cytoscape.NodePositionMap = Object.fromEntries(\r\n        nodes\r\n          .map((node) => {\r\n            return [node.id(), this.getGeographicPosition(node)];\r\n          })\r\n          .filter(([_id, position]) => {\r\n            return !!position;\r\n          })\r\n      );\r\n\r\n      // update only positions which have changed, for cytoscape-edgehandles compatibility\r\n      const currentPositions: cytoscape.NodePositionMap = Object.fromEntries(\r\n        nodes.map((node) => {\r\n          return [node.id(), { ...node.position() }];\r\n        })\r\n      );\r\n      const updatedPositions = getUpdatedPositionsMemo(\r\n        currentPositions,\r\n        positions\r\n      );\r\n\r\n      // hide nodes without position\r\n      const nodesWithoutPosition = nodes.filter(\r\n        (node) => !positions[node.id()]\r\n      );\r\n      const nodesWithPosition = nodes.filter(\r\n        (node) => !!positions[node.id()]\r\n      );\r\n\r\n      if (this.options?.hideNonPositional) {\r\n        nodesWithoutPosition.addClass(HIDDEN_CLASS).style('display', 'none');\r\n      }\r\n\r\n      nodesWithPosition\r\n        ?.layout({\r\n          name: 'preset',\r\n          positions: updatedPositions,\r\n          fit: false,\r\n        })\r\n        .run();\r\n    };\r\n\r\n    this.requestAnimationId = window.requestAnimationFrame(\r\n      function animatedUpdateGeographicPositions() {\r\n        updatePositions(nodes);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  private disableGeographicPositions() {\r\n    const nodes =\r\n      this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection);\r\n\r\n    // console.log(\"disableGeographicPositions\");\r\n    // this.cy\r\n    //   ?.layout({\r\n    //     name: 'preset',\r\n    //     positions: this.originalPositions,\r\n    //     fit: false,\r\n    //     animate: this.options?.animate,\r\n    //     animationDuration:\r\n    //       this.options?.animationDuration ?? DEFAULT_ANIMATION_DURATION,\r\n    //     animationEasing: 'ease-in-cubic',\r\n    //     stop: () => {\r\n    //       // show nodes without position\r\n    //       const nodesWithoutPosition = nodes.filter((node) =>\r\n    //         node.hasClass(HIDDEN_CLASS)\r\n    //       );\r\n    //       nodesWithoutPosition.removeClass(HIDDEN_CLASS).style('display', null);\r\n    //     },\r\n    //   })\r\n    //   .run();\r\n\r\n    this.deleteInternalLayoutPosition(nodes);\r\n    this.runDefaultLayout(nodes);\r\n    this.originalPositions = undefined;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {MouseEvent} event\r\n   */\r\n  private onGraphContainerMouseDown(event: MouseEvent) {\r\n    // @ts-ignore\r\n    const renderer = this.cy?.renderer();\r\n    if (\r\n      event.buttons === 1 &&\r\n      !isMultSelKeyDown(event) &&\r\n      !renderer.hoverData.down\r\n    ) {\r\n      // @ts-ignore,\r\n      if (this.cy) this.cy.renderer().hoverData.dragging = true; // cytoscape-lasso compatibility\r\n      this.dispatchMapEvent(event);\r\n\r\n      document.addEventListener(\r\n        'mouseup',\r\n        () => {\r\n          if (!this.panning) {\r\n            return;\r\n          }\r\n\r\n          this.panning = false;\r\n\r\n          // @ts-ignore, prevent unselecting in Cytoscape mouseup\r\n          if (this.cy) this.cy.renderer().hoverData.dragged = true;\r\n        },\r\n        { once: true }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {MouseEvent} event\r\n   */\r\n  private onGraphContainerMouseMove(event: MouseEvent) {\r\n    // @ts-ignore\r\n    const renderer = this.cy?.renderer();\r\n    if (\r\n      event.buttons === 1 &&\r\n      !isMultSelKeyDown(event) &&\r\n      !renderer.hoverData.down\r\n    ) {\r\n      this.panning = true;\r\n\r\n      this.dispatchMapEvent(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {MouseEvent} event\r\n   */\r\n  private onGraphContainerWheel(event: MouseEvent) {\r\n    event.preventDefault();\r\n    this.dispatchMapEvent(event);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  private onMapMove() {\r\n    if (this.layouting) {\r\n      // console.log(\"layouting\");\r\n      // When not-native-geographic nodes are in layouting we don't update their position. This should fix a glitch\r\n      // when you move the map when not-native-geographic nodes are in layouting\r\n      // TODO: fix this. It doesn't work because this.layouting become false too early\r\n      this.updateGeographicPositions(this.filterNodes('native-geographic'));\r\n    } else {\r\n      this.updateGeographicPositions();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.EventObject} event\r\n   */\r\n  private onLayoutStart(event: cytoscape.EventObject) {\r\n    const targets: cytoscape.NodeCollection = event[\"target\"][\"options\"][\"eles\"];\r\n\r\n    // we save when non-native-geographic nodes starts layouting\r\n    if (this.filterNodes('not-native-geographic', targets).length > 0) {\r\n      // console.log(\"onLayoutStart\");\r\n      this.layouting = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.EventObject} event\r\n   */\r\n  private onLayoutStop(event: cytoscape.EventObject) {\r\n    const targets: cytoscape.NodeCollection = event[\"target\"][\"options\"][\"eles\"];\r\n\r\n    // we save when non-native-geographic nodes stops layouting\r\n    if (this.filterNodes('not-native-geographic', targets).length > 0) {\r\n      // console.log(\"onLayoutStop\");\r\n      this.layouting = false;\r\n    }\r\n\r\n    this.saveInternalLayoutPositionAsLatLng(targets);\r\n  }\r\n\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  private onDataChange() {\r\n    this.updateGeographicPositions();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.EventObject} event\r\n   */\r\n  private onGraphAdd(event: cytoscape.EventObject) {\r\n    if (!event.target.isNode()) {\r\n      return;\r\n    }\r\n\r\n    const node: cytoscape.NodeSingular = event.target;\r\n\r\n    if (!this.originalPositions) this.originalPositions = {};\r\n    this.originalPositions[node.id()] = { ...node.position() };\r\n\r\n    const nodes = this.cy?.collection().merge(node);\r\n    this.updateGeographicPositions(nodes);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  private onGraphResize() {\r\n    this.map?.invalidateSize(false);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.EventObject} event\r\n   */\r\n  private onGraphDragFree(event: cytoscape.EventObject) {\r\n    const node: cytoscape.NodeSingular = event.target;\r\n\r\n    // some methods requires a node collection, let make it\r\n    const nodes = this.cy?.collection().merge(node);\r\n\r\n    if (this.options?.setPosition) {\r\n      const { x, y } = node.position();\r\n      const position: PointTuple = [x, y];\r\n      const lngLat = this.map?.containerPointToLatLng(position);\r\n      if (lngLat) this.options.setPosition(node, lngLat);\r\n    } else {\r\n      this.saveInternalLayoutPositionAsLatLng(nodes);\r\n    }\r\n\r\n    this.updateGeographicPositions(nodes);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {MouseEvent} event\r\n   */\r\n  private dispatchMapEvent(event: MouseEvent) {\r\n    if (\r\n      event.target === this.mapContainer ||\r\n      // @ts-ignore\r\n      this.mapContainer?.contains(event.target)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // @ts-ignore\r\n    const clonedEvent = new event.constructor(event.type, event);\r\n    this.map?.getContainer().dispatchEvent(clonedEvent);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.NodeSingular} node\r\n   * @return {L.LatLng | undefined}\r\n   */\r\n  private getNodeLngLat(node: cytoscape.NodeSingular): L.LatLng | undefined {\r\n    if (typeof this.options?.getPosition !== 'function') return;\r\n\r\n    const lngLatLike = this.options?.getPosition(node);\r\n    if (!lngLatLike) {\r\n      return;\r\n    }\r\n\r\n    let lngLat;\r\n    try {\r\n      lngLat = L.latLng(lngLatLike);\r\n    } catch (e) {\r\n      return;\r\n    }\r\n\r\n    return lngLat;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.NodeCollection} nodes\r\n   * @return {L.LatLngBounds}\r\n   */\r\n  private getNodeLngLatBounds(\r\n    nodes: cytoscape.NodeCollection = this.cy?.nodes() ??\r\n    ([] as unknown as cytoscape.NodeCollection)\r\n  ): L.LatLngBounds {\r\n    return nodes.reduce((bounds, node) => {\r\n      const lngLat = this.getNodeLngLat(node);\r\n      if (!lngLat) {\r\n        return bounds;\r\n      }\r\n\r\n      return bounds.extend(lngLat);\r\n    }, L.latLngBounds([]));\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {cytoscape.NodeSingular} node\r\n   * @param {boolean} onlyNativePosition no scratch position\r\n   * @return {cytoscape.Position | undefined}\r\n   */\r\n  private getGeographicPosition(\r\n    node: cytoscape.NodeSingular,\r\n    onlyNativePosition: boolean = false\r\n  ): cytoscape.Position | undefined {\r\n\r\n    const lngLat = onlyNativePosition\r\n      ? this.getNodeLngLat(node)\r\n      : this.getNodeLngLat(node) || (node.scratch('leaflet') && node.scratch('leaflet').currentGeoposition);\r\n\r\n    if (!lngLat) {\r\n      return;\r\n    }\r\n\r\n    return this.map?.latLngToContainerPoint(lngLat);\r\n  }\r\n\r\n  /**\r\n   * Filter a type of nodes out of nodes list.\r\n   *\r\n   * 4 types of nodes:\r\n   * <ul>\r\n   *   <li> <b>native-geographic</b>: nodes with a native geographic position (i.e. <i>this.getNodeLngLat()</i> returns non-null value) </li>\r\n   *   <li> <b>geographic</b>: nodes with a geographic position (either native position or internal - i.e. saved in <i>node.scratch()</i> - position) </li>\r\n   *   <li> <b>not-native-geographic</b>: nodes without a native geographic position (i.e. <i>this.getNodeLngLat()</i> returns null value) </li>\r\n   *   <li> <b>not-geographic</b>: nodes without a geographic position (neither native position nor internal position) </li>\r\n   * </ul>\r\n   * @private\r\n   * @param type\r\n   * @param nodes set of nodes to filter, if not specified all noeds on the graph will be filtered\r\n   */\r\n  private filterNodes(\r\n    type: 'geographic' | 'native-geographic' | 'not-geographic' | 'not-native-geographic',\r\n    nodes: cytoscape.NodeCollection = this.cy?.nodes() ?? ([] as unknown as cytoscape.NodeCollection)\r\n  ) {\r\n    const onlyNative = type == 'native-geographic' || type == 'not-native-geographic';\r\n\r\n    const positions: cytoscape.NodePositionMap = Object.fromEntries(\r\n      nodes\r\n        .map((node) => {\r\n          return [node.id(), this.getGeographicPosition(node, onlyNative)];\r\n        })\r\n        .filter(([_id, position]) => {\r\n          return !!position;\r\n        })\r\n    );\r\n\r\n    if (type == 'geographic' || type == \"native-geographic\") {\r\n      return nodes.filter((node) => !!positions[node.id()]);\r\n    } else { // not-geographic || not-native-geographic\r\n      return nodes.filter((node) => !positions[node.id()]);\r\n    }\r\n  }\r\n}\r\n","import L from 'leaflet';\r\nimport { MapHandler } from './mapHandler';\r\nimport { Instance, MapHandlerOptions } from './types';\r\n\r\nfunction register(cytoscape: Instance) {\r\n  if (!cytoscape) {\r\n    return;\r\n  }\r\n\r\n  cytoscape(\r\n    'core',\r\n    'L',\r\n    function (mapConfig: L.MapOptions, config: MapHandlerOptions) {\r\n      return new MapHandler(\r\n        // @ts-ignore\r\n        this,\r\n        mapConfig,\r\n        config\r\n      );\r\n    }\r\n  );\r\n}\r\n\r\nif (typeof window.cytoscape !== 'undefined') {\r\n  register(window.cytoscape);\r\n}\r\n\r\nexport default register;\r\n"],"names":["isMultSelKeyDown","event","shiftKey","metaKey","ctrlKey","arePositionsEqual","position1","position2","x","y","getUpdatedPositions","currentPositions","positions","Object","fromEntries","entries","filter","id","position","currentPosition","getUpdatedPositionsMemo","memoizeOne","assign","bind","tgt","srcs","forEach","src","keys","k","DEFAULT_FIT_PADDING","DEFAULT_ANIMATION_DURATION","HIDDEN_CLASS","DEFAULT_LAYOUT","name","MapHandler","cy","mapOptions","options","onGraphContainerMouseDown","onGraphContainerMouseMove","onGraphContainerWheel","onMapMove","onLayoutStart","onLayoutStop","onGraphAdd","onGraphResize","onGraphDragFree","onDataChange","getPosition","Error","setPosition","originalAutoungrabify","autoungrabify","originalUserZoomingEnabled","userZoomingEnabled","originalUserPanningEnabled","userPanningEnabled","graphContainer","container","addEventListener","onGraphContainerMouseDownBound","onGraphContainerMouseMoveBound","onGraphContainerWheelBound","on","onGraphAddBound","onGraphResizeBound","onGraphDragFreeBound","onDataChangeBound","onLayoutStartBound","onLayoutStopBound","mapContainer","document","createElement","style","top","left","width","height","prepend","map","L","Map","fit","undefined","padding","animate","onMapMoveBound","originalZoom","zoom","originalPan","pan","duration","animationDuration","easing","viewport","enableGeographicPositions","removeEventListener","off","remove","disableGeographicPositions","nodes","bounds","getNodeLngLatBounds","isValid","fitBounds","customOptions","layout","deleteInternalLayoutPosition","getDefaultLayout","run","node","scratch","currentGeoposition","containerPointToLatLng","originalPositions","getGeographicPosition","nodesWithoutPosition","nodesWithPosition","hideNonPositional","addClass","animationEasing","updatePositions","updatedPositions","requestAnimationId","window","requestAnimationFrame","animatedUpdateGeographicPositions","runDefaultLayout","renderer","buttons","hoverData","down","dragging","dispatchMapEvent","panning","dragged","once","preventDefault","layouting","updateGeographicPositions","filterNodes","targets","length","saveInternalLayoutPositionAsLatLng","target","isNode","collection","merge","invalidateSize","lngLat","contains","clonedEvent","constructor","type","getContainer","dispatchEvent","lngLatLike","latLng","e","reduce","getNodeLngLat","extend","latLngBounds","onlyNativePosition","latLngToContainerPoint","onlyNative","register","cytoscape","mapConfig","config"],"mappings":"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"}