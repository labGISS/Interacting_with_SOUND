!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],t):(o="undefined"!=typeof globalThis?globalThis:o||self).CytoscapeLeaflet=t(o.L)}(this,(function(o){"use strict";function t(o){return o&&"object"==typeof o&&"default"in o?o:{default:o}}var n=t(o);function i(o,t,n){return o(n={path:t,exports:{},require:function(o,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var e=i((function(o){o.exports=function(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")},o.exports.__esModule=!0,o.exports.default=o.exports})),a=i((function(o){function t(o,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}o.exports=function(o,n,i){return n&&t(o.prototype,n),i&&t(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o},o.exports.__esModule=!0,o.exports.default=o.exports})),r=i((function(o){o.exports=function(o,t,n){return t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o},o.exports.__esModule=!0,o.exports.default=o.exports})),s=i((function(o){o.exports=function(o){if(Array.isArray(o))return o},o.exports.__esModule=!0,o.exports.default=o.exports})),l=i((function(o){o.exports=function(o,t){var n=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null!=n){var i,e,a=[],r=!0,s=!1;try{for(n=n.call(o);!(r=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(o){s=!0,e=o}finally{try{r||null==n.return||n.return()}finally{if(s)throw e}}return a}},o.exports.__esModule=!0,o.exports.default=o.exports})),u=i((function(o){o.exports=function(o,t){(null==t||t>o.length)&&(t=o.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=o[n];return i},o.exports.__esModule=!0,o.exports.default=o.exports})),h=i((function(o){o.exports=function(o,t){if(o){if("string"==typeof o)return u(o,t);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(o,t):void 0}},o.exports.__esModule=!0,o.exports.default=o.exports})),d=i((function(o){o.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},o.exports.__esModule=!0,o.exports.default=o.exports}));function c(o){return o.shiftKey||o.metaKey||o.ctrlKey}i((function(o){o.exports=function(o,t){return s(o)||l(o,t)||h(o,t)||d()},o.exports.__esModule=!0,o.exports.default=o.exports}));var p=null!=Object.assign?Object.assign.bind(Object):function(o){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.forEach((function(t){Object.keys(t).forEach((function(n){return o[n]=t[n]}))})),o};function v(o,t){var n=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.push.apply(n,i)}return n}function f(o){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){r(o,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(n,t))}))}return o}var y=[50,50],g="cytoscape-map__hidden",m={name:"preset"},b=function(){function o(t,i,a){if(e(this,o),r(this,"cy",void 0),r(this,"mapOptions",void 0),r(this,"options",void 0),r(this,"mapContainer",void 0),r(this,"map",void 0),r(this,"originalAutoungrabify",void 0),r(this,"originalUserZoomingEnabled",void 0),r(this,"originalUserPanningEnabled",void 0),r(this,"originalPositions",void 0),r(this,"originalZoom",void 0),r(this,"originalPan",void 0),r(this,"panning",!1),r(this,"requestAnimationId",void 0),r(this,"onGraphContainerMouseDownBound",this.onGraphContainerMouseDown.bind(this)),r(this,"onGraphContainerMouseMoveBound",this.onGraphContainerMouseMove.bind(this)),r(this,"onGraphContainerWheelBound",this.onGraphContainerWheel.bind(this)),r(this,"onMapMoveBound",this.onMapMove.bind(this)),r(this,"onMapMoveEndBound",this.onMapMoveEnd.bind(this)),r(this,"onGraphAddBound",this.onGraphAdd.bind(this)),r(this,"onGraphResizeBound",this.onGraphResize.bind(this)),r(this,"onGraphDragFreeBound",this.onGraphDragFree.bind(this)),r(this,"onDataChangeBound",this.onDataChange.bind(this)),r(this,"saveLayoutPositionAsLatLngBound",this.saveLayoutPositionAsLatLng.bind(this)),this.cy=t,this.mapOptions=i,this.options=a,"function"!=typeof this.options.getPosition)throw new Error("getPosition should be a function");if(this.options.setPosition&&"function"!=typeof this.options.setPosition)throw new Error("setPosition should be a function");this.originalAutoungrabify=this.cy.autoungrabify(),this.originalUserZoomingEnabled=this.cy.userZoomingEnabled(),this.originalUserPanningEnabled=this.cy.userPanningEnabled(),this.cy.userZoomingEnabled(!1),this.cy.userPanningEnabled(!1);var s=this.cy.container();this.cy.on("tapstart",this.onGraphContainerMouseDownBound),s.addEventListener("wheel",this.onGraphContainerWheelBound),this.cy.on("add",this.onGraphAddBound),this.cy.on("resize",this.onGraphResizeBound),this.cy.on("dragfree",this.onGraphDragFreeBound),this.cy.on("cxttap","node",(function(o){o.target.unlock()})),this.cy.on("data",this.onDataChangeBound),this.mapContainer=document.createElement("div"),this.mapContainer.style.position="absolute",this.mapContainer.style.top="0px",this.mapContainer.style.left="0px",this.mapContainer.style.width="100%",this.mapContainer.style.height="100%",null==s||s.prepend(this.mapContainer),this.map=new n.default.Map(this.mapContainer,this.mapOptions),this.fit(void 0,{padding:y,animate:!1}),this.map.on("move",this.onMapMoveBound),this.map.on("moveend",this.onMapMoveEndBound),this.originalZoom=this.cy.zoom(),this.originalPan=f({},this.cy.pan());var l,u={x:0,y:0};this.options.animate?this.cy.animate({zoom:1,pan:u},{duration:null!==(l=this.options.animationDuration)&&void 0!==l?l:1,easing:"linear"}):this.cy.viewport({zoom:1,pan:u});this.enableGeographicPositions()}return a(o,[{key:"destroy",value:function(){var o,t,n,i,e,a,r,s,l,u,h,d=null===(o=this.cy)||void 0===o?void 0:o.container();(d&&d.removeEventListener("wheel",this.onGraphContainerWheelBound),this.cy&&(this.cy.off("tapstart",this.onGraphContainerMouseDownBound),this.cy.off("add",this.onGraphAddBound),this.cy.off("resize",this.onGraphResizeBound),this.cy.off("dragfree",this.onGraphDragFreeBound),this.cy.off("data",this.onDataChangeBound),this.cy.autoungrabify(this.originalAutoungrabify),this.cy.userZoomingEnabled(this.originalUserZoomingEnabled),this.cy.userPanningEnabled(this.originalUserPanningEnabled)),this.originalAutoungrabify=void 0,this.originalUserZoomingEnabled=void 0,this.originalUserPanningEnabled=void 0,null===(t=this.map)||void 0===t||t.off("move",this.onMapMoveBound),null===(n=this.map)||void 0===n||n.off("dragend"),null===(i=this.map)||void 0===i||i.remove(),this.map=void 0,null===(e=this.mapContainer)||void 0===e||e.remove(),this.mapContainer=void 0,null!==(a=this.options)&&void 0!==a&&a.animate)?null===(r=this.cy)||void 0===r||r.animate({zoom:this.originalZoom,pan:this.originalPan},{duration:null!==(s=this.options.animationDuration)&&void 0!==s?s:1,easing:"linear"}):null===(l=this.cy)||void 0===l||l.viewport({zoom:null!==(u=this.originalZoom)&&void 0!==u?u:5,pan:null!==(h=this.originalPan)&&void 0!==h?h:{x:0,y:0}});this.originalZoom=void 0,this.originalPan=void 0,this.disableGeographicPositions(),this.cy=void 0,this.options=void 0}},{key:"fit",value:function(){var o,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!==(o=null===(t=this.cy)||void 0===t?void 0:t.nodes())&&void 0!==o?o:[],e=arguments.length>1?arguments[1]:void 0,a=this.getNodeLngLatBounds(i);a.isValid()&&(null===(n=this.map)||void 0===n||n.fitBounds(a,e))}},{key:"saveLayoutPositionAsLatLng",value:function(){var o,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===(o=this.cy)||void 0===o?void 0:o.nodes();null==n||n.forEach((function(o){var n;o.scratch("leaflet",{currentGeoposition:null===(n=t.map)||void 0===n?void 0:n.containerPointToLatLng(o.position())})}))}},{key:"deleteLatLngLayoutPosition",value:function(){var o,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===(o=this.cy)||void 0===o?void 0:o.nodes();null==t||t.forEach((function(o){o.scratch("leaflet")&&o.scratch("leaflet").currentGeoposition&&delete o.scratch("leaflet").currentGeoposition}))}},{key:"updateNodePosition",value:function(){var o,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null===(o=this.cy)||void 0===o?void 0:o.nodes();null==n||n.forEach((function(o){var n;o.unlock();var i=t.getGeographicPosition(o);i&&(o.position(i),o.lock()),!i&&null!==(n=t.options)&&void 0!==n&&n.hideNonPositional&&o.addClass(g).style("display","none")}))}},{key:"getLayout",value:function(){var o,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return p(m,null===(o=this.options)||void 0===o?void 0:o.layout,t)}},{key:"enableGeographicPositions",value:function(){var o,t,n,i=this,e=null!==(o=null===(t=this.cy)||void 0===t?void 0:t.nodes())&&void 0!==o?o:[];this.originalPositions=Object.fromEntries(e.map((function(o){return[o.id(),f({},o.position())]}))),null===(n=this.cy)||void 0===n||n.nodes().forEach((function(o){i.getNodeLngLat(o)&&o.lock()})),this.updateNodePosition(e)}},{key:"updateGeographicPositions",value:function(){var o,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!==(o=null===(t=this.cy)||void 0===t?void 0:t.nodes())&&void 0!==o?o:[];this.updateNodePosition(n)}},{key:"disableGeographicPositions",value:function(){var o,t,n,i,e,a=null!==(o=null===(t=this.cy)||void 0===t?void 0:t.nodes())&&void 0!==o?o:[];null!==(n=this.options)&&void 0!==n&&n.hideNonPositional&&a.filter((function(o){return o.hasClass(g)})).removeClass(g).style("display",null);a.forEach((function(o){o.unlock()})),null===(i=this.cy)||void 0===i||i.fit(),null===(e=this.cy)||void 0===e||e.one("layoutstop",(function(o){o.cy.nodes().unlock()})),this.originalPositions=void 0}},{key:"onGraphContainerMouseDown",value:function(o){var t,n=this,i=o.originalEvent,e=null===(t=this.cy)||void 0===t?void 0:t.renderer();!this.cy||1!==i.buttons||c(i)||e.hoverData.down||(this.cy.renderer().hoverData.dragging=!0,this.saveLayoutPositionAsLatLng(o.cy.nodes()),this.dispatchMapEvent(i),this.cy.one("tapdrag",this.onGraphContainerMouseMoveBound),o.cy.one("tapend",(function(o){n.panning&&(n.panning=!1,n.cy.renderer().hoverData.dragged=!0)})))}},{key:"onGraphContainerMouseMove",value:function(o){var t,n=o.originalEvent,i=null===(t=this.cy)||void 0===t?void 0:t.renderer();1!==n.buttons||c(n)||i.hoverData.down||(this.panning=!0,o.preventDefault(),this.dispatchMapEvent(n))}},{key:"onGraphContainerWheel",value:function(o){o.preventDefault(),this.dispatchMapEvent(o)}},{key:"onMapMove",value:function(){this.updateGeographicPositions()}},{key:"onDataChange",value:function(){this.updateGeographicPositions()}},{key:"onMapMoveEnd",value:function(){var o,t=this;setTimeout((function(){var o;null===(o=t.cy)||void 0===o||o.nodes().forEach((function(o){t.getNodeLngLat(o)||o.unlock()}))}),(null===(o=this.options)||void 0===o?void 0:o.delayOnMove)||0)}},{key:"onGraphAdd",value:function(o){var t;if(o.target.isNode()){var n=o.target;this.originalPositions||(this.originalPositions={}),this.originalPositions[n.id()]=f({},n.position());var i=null===(t=this.cy)||void 0===t?void 0:t.collection().merge(n);this.updateGeographicPositions(i)}}},{key:"onGraphResize",value:function(){var o;null===(o=this.map)||void 0===o||o.invalidateSize(!1)}},{key:"onGraphDragFree",value:function(o){var t,n,i=o.target;if(null!==(t=this.options)&&void 0!==t&&t.setPosition){var e,a=i.position(),r=[a.x,a.y],s=null===(e=this.map)||void 0===e?void 0:e.containerPointToLatLng(r);s&&this.options.setPosition(i,s)}var l=null===(n=this.cy)||void 0===n?void 0:n.collection().merge(i);this.updateGeographicPositions(l)}},{key:"dispatchMapEvent",value:function(o){var t,n;if(!(o.target===this.mapContainer||null!==(t=this.mapContainer)&&void 0!==t&&t.contains(o.target))){var i=new o.constructor(o.type,o);null===(n=this.map)||void 0===n||n.getContainer().dispatchEvent(i)}}},{key:"getNodeLngLat",value:function(o){var t,i;if("function"==typeof(null===(t=this.options)||void 0===t?void 0:t.getPosition)){var e=null===(i=this.options)||void 0===i?void 0:i.getPosition(o);if(e){var a;try{a=n.default.latLng(e)}catch(o){return}return a}}}},{key:"getNodeLngLatBounds",value:function(){var o,t,i=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null!==(o=null===(t=this.cy)||void 0===t?void 0:t.nodes())&&void 0!==o?o:[];return e.reduce((function(o,t){var n=i.getNodeLngLat(t);return n?o.extend(n):o}),n.default.latLngBounds([]))}},{key:"getGeographicPosition",value:function(o){var t,n=this.getNodeLngLat(o)||o.scratch("leaflet")&&o.scratch("leaflet").currentGeoposition;if(n)return null===(t=this.map)||void 0===t?void 0:t.latLngToContainerPoint(n)}}]),o}();function P(o){o&&o("core","L",(function(o,t){return new b(this,o,t)}))}return void 0!==window.cytoscape&&P(window.cytoscape),P}));
//# sourceMappingURL=cytoscape-leaflet-1.0.15-lock-nodes.min.js.map
